{"componentChunkName":"component---src-templates-post-template-tsx","path":"/axios_interceptors/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p>Axios를 사용하여 API와 통신할 때, 토큰 기반 인증을 사용하는 경우가 많습니다. 이러한 경우, 항상 헤더에 인증 토큰을 포함시켜야 합니다. 그리고 토큰이 만료되었을 때 refresh token으로 새로운 토큰을 발급받아 API를 다시 요청해야하는데 Axios Interceptor를 사용하여 이를 간단하게 처리할 수 있습니다.</p>\n<h1>로직 순서</h1>\n<p>구현에 앞서 어떤 순서로 interceptor 내부 동작을 구현해야할 지 정리해보겠습니다.</p>\n<ol>\n<li>\n<p>토큰이 필요한 API, 토큰이 필요없는 API 구분<br>\n우선 로그인한 사용자만 사용할 수 있는 API와 모든 사용자(비로그인 사용자)가 사용하는 API를 구분합니다.<br>\n후자의 경우 그냥 일반적인 axios instance를 생성하는 것과 같습니다.</p>\n</li>\n<li>\n<p>API 요청 시 토큰을 헤더에 담기<br>\nAPI 요청을 Interceptor로 가로채서 요청이 전달되기 전에 instance header에 토큰을 담아서 보내줍니다.</p>\n</li>\n<li>\n<p>토큰 만료시 refresh token으로 토큰 재발급, 재발급받은 토큰으로 API 재요청<br>\nAPI 호출 시 401 에러(인증 에러)를 받았을 때, 마찬가지로 interceptor로 응답을 가로채서 refresh token을 사용하여 토큰을 재발급 받습니다. 그리고 재발급된 토큰을 헤더에 넣어서 다시 해당 API를 호출합니다.</p>\n</li>\n</ol>\n<h1>코드 구현</h1>\n<p>토큰이 필요하거나 필요없는 API에 따라 다른 아래와 같이 토큰없이 보내는 <code class=\"language-text\">instance</code>, 토큰과 함께 보내는 <code class=\"language-text\">intanceWithToken</code>을 만들어서 상황에따라 맞는 인스턴스를 사용하여 API를 호출하도록 할 것입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">instance<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ninstanceWithToken<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>두 인스턴스를 각각 만들어 export 해주겠습니다. <code class=\"language-text\">axios.create</code> 를 사용해서 baseURL, headers 등 원하는 설정을 넣어주고 withToken에는 setInterceptors로 감싸서 반환해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// index.ts</span>\n<span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">\"axios\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> setInterceptors <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./interceptors\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createInstance</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">baseURL</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://base-url.com\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">\"Content-Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"application/json; charset=utf-8\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createInstanceWithToken</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> instance <span class=\"token operator\">=</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">baseURL</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://base-url.com\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">\"Content-Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"application/json; charset=utf-8\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token function\">setInterceptors</span><span class=\"token punctuation\">(</span>instance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> instance <span class=\"token operator\">=</span> <span class=\"token function\">createInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> instanceWithToken <span class=\"token operator\">=</span> <span class=\"token function\">createInstanceWithToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>먼저 인스턴스를 받아서 해당 인스턴스의 요청과 응답을 가로채서 토큰을 넣고 재발급을 받는 등 작업을 수행하는 <code class=\"language-text\">setInterceptors</code> 함수를 만들 것입니다. 먼저 요청을 가로채서 헤더에 토큰을 넣는 <code class=\"language-text\">interceptors.request</code> 를 먼저 작성해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// interceptors.ts</span>\n<span class=\"token keyword\">import</span> axios<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> \n\tAxiosInstance<span class=\"token punctuation\">,</span> \n\tInternalAxiosRequestConfig<span class=\"token punctuation\">,</span> \n\tAxiosError<span class=\"token punctuation\">,</span>\n\tAxiosResponse\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"axios\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">setInterceptors</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">instance</span><span class=\"token operator\">:</span> AxiosInstance</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  instance<span class=\"token punctuation\">.</span>interceptors<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">config</span><span class=\"token operator\">:</span> InternalAxiosRequestConfig</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">getItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"accessToken\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        config<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">[</span><span class=\"token string\">\"Authorization\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Bearer </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>token<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">return</span> config<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">error</span><span class=\"token operator\">:</span> AxiosError <span class=\"token operator\">|</span> Error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>코드를 순서대로 보시면 어떤 식으로 동작하는지 쉽게 확인할 수 있습니다. instance를 받아서 interceptors.request.use로 요청을 가로챈 뒤에 토큰을 가져와서 토큰이 있다면 config.headers로 직접 헤더에 토큰을 넣은 뒤에 config를 반환합니다. 그리고 추가적으로 에러를 처리하는 코드를 마지막에 넣었습니다.</p>\n<p>이제 위의 <code class=\"language-text\">instanceWithToken</code> 으로 API를 호출할 때 토큰이 있으면 헤더에 토큰을 넣어서 보내게 됩니다.<br>\n(저는 추가적으로 타입스크립트를 사용했기 때문에 axios에 내장되어있는 타입을 가져와서 지정해주었습니다.)</p>\n<p>다음으로 응답을 가로채서 토큰이 만료되었을 때 refresh token을 가져와서 새로운 토큰을 발급받고 이를 헤더에 넣어서 재요청하는 코드를 작성하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">setInterceptors</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">instance</span><span class=\"token operator\">:</span> AxiosInstance</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  instance<span class=\"token punctuation\">.</span>interceptors<span class=\"token punctuation\">.</span>response<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">response</span><span class=\"token operator\">:</span> AxiosResponse</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>code <span class=\"token operator\">===</span> <span class=\"token number\">401</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>errorMsg <span class=\"token operator\">===</span> <span class=\"token string\">\"expired token\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> refreshToken <span class=\"token operator\">=</span> <span class=\"token function\">getRefreshToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">return</span> instance\n            <span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/members/reissue\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token literal-property property\">refreshToken</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Bearer </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>refreshToken<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">refreshResponse</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">const</span> newAccessToken <span class=\"token operator\">=</span> refreshResponse<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>accessToken<span class=\"token punctuation\">;</span>\n              <span class=\"token keyword\">const</span> newRefreshToken <span class=\"token operator\">=</span> refreshResponse<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>refreshToken<span class=\"token punctuation\">;</span>\n              <span class=\"token function\">setAccessToken</span><span class=\"token punctuation\">(</span>newAccessToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n              <span class=\"token function\">setRefreshToken</span><span class=\"token punctuation\">(</span>newRefreshToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n              response<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">.</span>Authorization <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Bearer </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>newAccessToken<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n              <span class=\"token keyword\">return</span> <span class=\"token function\">instance</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">refreshError</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">const</span> formattedError <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">message</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Refresh Token renewal failed\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">originalError</span><span class=\"token operator\">:</span> refreshError<span class=\"token punctuation\">,</span>\n              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n              <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>formattedError<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\tlocalStorage<span class=\"token punctuation\">.</span><span class=\"token function\">removeItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"accessToken\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t  localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">removeItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"refreshToken\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span><span class=\"token function\">reload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">error</span><span class=\"token operator\">:</span> AxiosError <span class=\"token operator\">|</span> Error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>axios<span class=\"token punctuation\">.</span><span class=\"token function\">isAxiosError</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> status <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> error<span class=\"token punctuation\">.</span>response <span class=\"token keyword\">as</span> AxiosResponse<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>status <span class=\"token operator\">===</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>제 경우에는 api에서 토큰이 없을 경우에 error로 내려오지 않고 response.code: 401로 내려오도록 되어있기 때문에 response에서 refresh 작업을 처리했습니다. 만약 errer: 401로 내려온다면 코드 하단에 에러 처리 부분에서 <code class=\"language-text\">if(error.response.status === 401)</code> 와 같이 if문으로 처리하면 됩니다.</p>\n<p>코드를 순차적으로 살펴보면 먼저 리프레시 토큰이 있을때 그 토큰을 재발급 받는 api를 통해서 새로운 access, refresh 토큰을 받아옵니다. 받아온 토큰을 다시 로컬스토리지에 저장하고<code class=\"language-text\">response.config.headers.Authorization</code> 로 인스턴스 헤더에 다시 토큰을 넣어서 인스턴스를 반환하면 다시 api를 호출하게 됩니다. 즉, <code class=\"language-text\">instance(response.config);</code> 에서 새로운 설정을 원래의 요청으로 다시 보내는 것입니다. 그 과정에서 에러가 발생했을 때 <code class=\"language-text\">.catch</code>로 에러를 처리하고 만약 401인데 토큰이 만료된 것이 아닐 경우에 로컬스토리지의 토큰을 모두 지우고 화면을 리로드합니다.</p>\n<p>이 외의 에러는 <code class=\"language-text\">instance.interceptors.response.use</code> 의 두번째 인자로 <code class=\"language-text\">(error)=>{}</code> 함수 내에서 처리합니다.</p>\n<p>구현을 완료했습니다. 이제 instanceWithToken을 필요한 곳에 사용할 수 있습니다. 간  한예시실로 yscn/cwit으t아로 래처럼 사용할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getData</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> instanceWithToken<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/data/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\t\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Axios의 Interceptors를 사용해서 토큰을 처리하는 코드를 작성해보았습니다. 이 외에도 다른 방식으로 토큰을 관리할 수도 있고 Interceptors로 토큰이 아닌 다른 처리를 할 수도 있습니다. 만약 아직 사용해보지 않았다면 API 요청과 응답을 interceptors를 통해서 깔끔하고 효과적으로 관리해보시면 좋을 것 같습니다.</p>","frontmatter":{"title":"Axios Interceptors를 활용한 토큰, 리프레시 토큰 처리","summary":"Axios Interceptors로 API 요청과 응답을 가로채서 효율적으로 관리해보자!","date":"2023년 08월 03일","categories":["Axios","Interceptors","Auth"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAUABQDASIAAhEBAxEB/8QAGgABAAIDAQAAAAAAAAAAAAAAAAYHAQQICf/EABYBAQEBAAAAAAAAAAAAAAAAAAQFAv/aAAwDAQACEAMQAAAB9wqisDnOjB7HYCpasaNnmAwj/8QAGhABAAIDAQAAAAAAAAAAAAAABQADAgQGFf/aAAgBAQABBQJTd804TrtxtidEfYuZyoVhiUzww2KTwBirJ//EACARAAICAgAHAAAAAAAAAAAAAAIDAQQFEgAQERMzU4L/2gAIAQMBAT8BuZwKJRjxxNmzYsmEjkRYGiE7omwC6ZRLbTARDJliBPtS4ZLWV7DwyrVa1b21kMenwuYlZtV19bCGTD5mOX//xAAhEQADAAECBwEAAAAAAAAAAAABAgMRBBIAEBMiMTJygf/aAAgBAgEBPwHT6IWm921M0EwR0WVssxBEy1R2TBfwKEbtpxnODwtaqrItHVH90V2Cv9KDhv3l/8QAJhAAAgIBAwIGAwAAAAAAAAAAAQIDBBIFERMAIRAUIjEyQhVDYf/aAAgBAQAGPwK7fwWTyleSfjaThV8Bvs0pBEan7OQQg9R7DqehDp0SValuxBascsjNHDFSqWIpu6ouUs1tK4Tv8eT4n0dNpS86xajYr1bktYxrLFRdy1lwZQVxIRY22UsVcge+4/IULupakz3aceoKk0K1+CzNqEVue6n7+A1kxxKGMjLZzHCng0cyh45osZE77MsibOvYg7EEj33/AL1y6bp8FNzCsB4TIFMSvmFKGQoTl3MhXlb7OfD/xAAZEAEBAAMBAAAAAAAAAAAAAAABEQAhMRD/2gAIAQEAAT8h4JcEqZ5SbUQUw8c65SLCudIr5cc4zYUKESLKyMVGXBRWax1MX3i1QMTaBB0YIdVvEaUpslibWCPh/9oADAMBAAIAAwAAABBgAMD/xAAYEQEBAQEBAAAAAAAAAAAAAAARARAhMf/aAAgBAwEBPxCsksWRjST9VgVeb6hnsFr3tc//xAAYEQEBAQEBAAAAAAAAAAAAAAARARAhMf/aAAgBAgEBPxCDxEyGTBU4lDOAP+4DeEEQNM//xAAdEAEBAAIBBQAAAAAAAAAAAAABEQAQIUFRYXGB/9oACAEBAAE/EOcymcCM/UbLDH7QL2OCTpKNYXvVwn3sJ4NED280U+SJfcMHg3svmhfnTL0eXLyY3TOIJiwRq2IiXdtMpr//2Q=="},"images":{"fallback":{"src":"/static/78b62715e92e8ef80d947313a8e4a515/44dd9/axios.jpg","srcSet":"/static/78b62715e92e8ef80d947313a8e4a515/80079/axios.jpg 256w,\n/static/78b62715e92e8ef80d947313a8e4a515/a008c/axios.jpg 512w,\n/static/78b62715e92e8ef80d947313a8e4a515/44dd9/axios.jpg 1024w","sizes":"(min-width: 1024px) 1024px, 100vw"},"sources":[{"srcSet":"/static/78b62715e92e8ef80d947313a8e4a515/99d55/axios.webp 256w,\n/static/78b62715e92e8ef80d947313a8e4a515/3591c/axios.webp 512w,\n/static/78b62715e92e8ef80d947313a8e4a515/e306d/axios.webp 1024w","type":"image/webp","sizes":"(min-width: 1024px) 1024px, 100vw"}]},"width":1024,"height":1024}},"publicURL":"/static/78b62715e92e8ef80d947313a8e4a515/axios.jpeg"}}}}]},"file":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAUABQDASIAAhEBAxEB/8QAGgABAAMAAwAAAAAAAAAAAAAAAAQFBwIICf/EABYBAQEBAAAAAAAAAAAAAAAAAAIDAf/aAAwDAQACEAMQAAAB9samFlU6doUA51HExaMEf//EABsQAAIDAQEBAAAAAAAAAAAAAAIFAwQGARMi/9oACAEBAAEFAn7BtF1oiclXV2p7lGz6w6LNVLMLdF9p9InjawDks3wREQH/xAAbEQABBQEBAAAAAAAAAAAAAAABAhARIUFhgf/aAAgBAwEBPwFIqZSIu94eNg9b/8QAGxEAAgIDAQAAAAAAAAAAAAAAASEQEUFxgeH/2gAIAQIBAT8BJdNmtexk8j//xAAlEAACAgIBBAICAwAAAAAAAAACAwEEBRETABIUIQYiIzEyQVH/2gAIAQEABj8Cq0Pj9evYydh9Y3lantr0MTNoE3bxfYOVwiUjVriUkxm2SBrSYzasYf5DkE5s0JCu241TcVBhKRaZYvxTqDyrFpfjVBwxn1MY1pDrKYTa/Im2oN8YWqrmVrPF3TJSiXqMq5F9iTKyL3M9ZS3VGDyAYSAmqRzLrOOASdRbST/FpIyo36zVbD3cURsjvUJ1GeDxhQS2ni02cfexkY/HWVV5sUUTeEVd7W11s46oB9FKCVzCWHNB87graIvN3vfNfmbjv3/jXnG/7iNx610gvMvY+xXYxSrePYgHwjIL8G4ifJr2kytymQXtPIt6UPSa2Kguu0sPTbI9sCywE2HhxzHbK3vljkzsYLajCZmN9CADAAEQIiMQIiIxoRGI9RERGoiPUR1//8QAGBABAQEBAQAAAAAAAAAAAAAAAREAITH/2gAIAQEAAT8heI5/xCL6xdS/QnrkUaRG5hFplj5gRtmuZYCbud8Tj4PHy2ky22IUWr34DavOkL4AF7SsBUBBjVuMMy6TbcJKpAbbUxaLRpJx9o/iCIHhgAABv//aAAwDAQACAAMAAAAQFPgA/8QAGxEBAAIDAQEAAAAAAAAAAAAAAREhADFxEJH/2gAIAQMBAT8QFQgaAVsLIwaBUJK3WNL1xUjUvRTSJ8VTvn//xAAcEQEBAAICAwAAAAAAAAAAAAABESExAFEQcZH/2gAIAQIBAT8QmELcFACFIXZXNITE4aPRwBuDjYuxH6APYHXj/8QAFxABAQEBAAAAAAAAAAAAAAAAAREAIf/aAAgBAQABPxCX/FfjeibBnSlMyEvCdnXXdYGOOCBIkByZBL7Wk9AGI2YDYxBV33YyIdV6CrQr9/nTKCI2gC5SZiNz+gyXY06QsciQhqamF4bZmFgH/9k="},"images":{"fallback":{"src":"/static/ae91b527e5e44c319ca3c0dc2a238c15/c3a8c/profile-image.jpg","srcSet":"/static/ae91b527e5e44c319ca3c0dc2a238c15/2e59f/profile-image.jpg 11w,\n/static/ae91b527e5e44c319ca3c0dc2a238c15/ef9f5/profile-image.jpg 23w,\n/static/ae91b527e5e44c319ca3c0dc2a238c15/c3a8c/profile-image.jpg 45w,\n/static/ae91b527e5e44c319ca3c0dc2a238c15/936b0/profile-image.jpg 90w","sizes":"(min-width: 45px) 45px, 100vw"},"sources":[{"srcSet":"/static/ae91b527e5e44c319ca3c0dc2a238c15/0513d/profile-image.webp 11w,\n/static/ae91b527e5e44c319ca3c0dc2a238c15/31868/profile-image.webp 23w,\n/static/ae91b527e5e44c319ca3c0dc2a238c15/85c56/profile-image.webp 45w,\n/static/ae91b527e5e44c319ca3c0dc2a238c15/be9e0/profile-image.webp 90w","type":"image/webp","sizes":"(min-width: 45px) 45px, 100vw"}]},"width":45,"height":45}}}},"pageContext":{"slug":"/axios_interceptors/"}},"staticQueryHashes":[],"slicesMap":{}}