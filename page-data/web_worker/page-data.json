{"componentChunkName":"component---src-templates-post-template-tsx","path":"/web_worker/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h1>Web Worker의 필요성</h1>\n<p>Web Worker는 브라우저의 메인 스레드와는 별개로 동작하며 백그라운드 스레드에서 실행되기 때문에 유저 인터페이스를 방해하지 않고 작업을 수행할 수 있습니다.</p>\n<p>자바스크립트는 싱글 스레드로 동작하기 때문에 한 번에 하나의 작업만 수행이 가능합니다. 비동기 작업을 통해 자연스럽게 화면 동작이 가능하지만 비동기는 작업의 우선 순위를 뒤로 미루는 것이지 병렬로 실행되는 것이 아닙니다. 브라우저의 이벤트 루프 동작을 이해하시면 이를 알 수 있습니다.</p>\n<div class=\"img_wrapper\">\n  <p class=\"loop_img\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 576px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/d4e8aa624e953d912d27095a715e1bb1/694da/event_loop.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.729166666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACG0lEQVR42mWTz2rUUBjF5wnc+h4upCr4GH0K1+5dKCquLApdWBBBLL5C60aqYIuWgTYiM3U6TCaZTJqbmz/3T/79JHdanOqFQ76b3Jx85zsnAzrous6hr1WpMNpQ2QprKiqbUNkSa/vaumfWGIwqsVpTW4PRykGVJYMrQndtO6yxNE1DkWdYC0nwApl8xxjcC+tLVTBfSmy72htbM1jvzhH2XRhLtFgQznwyETH3pwTzOVKI/hgUAe3pB/LjXbIf71HDXfj5EZNM/xL2aNvWSdNak2eK0NaMwwiaXgVIkbpO9GifdPsWk5d3mL26y3Rrg+LNBvb8gAH/rL5DqxVeqJhPZvjhDC130fItWerjRznjz+/QO7dZbt9zpOHrDcqdO+jJAYPzyTnD4RDv1MPzvJUZ1iAWKe3JCJ1fkC0fUqUPmP4+ZhEXIMfw7Qly/xHx3mPqr8/h8Bkm+sWgn1vbtE7uylmLsYblNEYXUChJFm1RxE8RycSpaDs3SYJlimlWyrorU1y1BmOM+4BIBUkSEwYLisJQ1zjXe6720tWz0RkiuVht2sZF6rrLXeduuggYg0wleZ6jtUXlR+hsD10cobIvmOITcTRCysLlss9vJrP/c7hOGMwDF584LigWm/jeDRq5SebfZzm+Ce3Bpd7VyPoGrhN2HUopN8fK/RkVdV2jSkN6cUKeHiLFKZkYkokjpAiQaY6UklSkDn8Avwg6K2C2Y64AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <picture>\n          <source srcset=\"/static/d4e8aa624e953d912d27095a715e1bb1/a59e9/event_loop.webp 192w,\n/static/d4e8aa624e953d912d27095a715e1bb1/0ca9f/event_loop.webp 384w,\n/static/d4e8aa624e953d912d27095a715e1bb1/f1c97/event_loop.webp 576w\" sizes=\"(max-width: 576px) 100vw, 576px\" type=\"image/webp\">\n          <source srcset=\"/static/d4e8aa624e953d912d27095a715e1bb1/3b721/event_loop.png 192w,\n/static/d4e8aa624e953d912d27095a715e1bb1/66595/event_loop.png 384w,\n/static/d4e8aa624e953d912d27095a715e1bb1/694da/event_loop.png 576w\" sizes=\"(max-width: 576px) 100vw, 576px\" type=\"image/png\">\n          <img class=\"gatsby-resp-image-image\" src=\"/static/d4e8aa624e953d912d27095a715e1bb1/694da/event_loop.png\" alt=\"event loop\" title=\"\" loading=\"lazy\" decoding=\"async\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n        </picture>\n  </a>\n    </span>\n  </p>\n</div>\n<!-- ![Event Loop](./event_loop.png) -->\n<p>우리가 직접 작성한 코드는 모두 메인 스레드에서 처리됩니다. 파일 시스템이나 Network 통신과 같은 Web API의 일부 함수는 멀티 스레드로 처리가 되는 것도 있지만 그 외의 로직은 비동기라 하더라도 시간이 오래 소요되게 됩니다. 그렇기 때문에 데이터 처리가 많아질수록 병목현상이 생겨 UI 업데이트가 지연되고 사용자에게 느리게 느껴지게 됩니다. 이를 해결하기 위해 브라우저에서 Web Worker API를 제공하고 있습니다.</p>\n<h1>Web Worker 사용방법</h1>\n<p>Web Worker는 필요한 개수만큼 생성할 수 있고 스레드를 만들어 사용하는 것과 같습니다. 메인 스레드와 Web Worker는 메시지 방식으로 서로 통신하며 데이터를 주고받습니다.</p>\n<p>Web Worker의 사용법을 살펴보겠습니다. 우선 Worker() 생성자를 호출하여 워커 스레드에서 실행할 스크립트의 경로를 지정하면 됩니다. 그리고 postMessage() 메서드와 onmessage 이벤트 핸들러를 통해 워커에게 메시지를 보낼 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// main.js</span>\n<span class=\"token keyword\">const</span> worker <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Worker</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myWorker.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nfirstInput<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onChange</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\tworker<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>firstInput<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span> secondInput<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nsecondInput<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onChange</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\tworker<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>firstInput<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span> secondInput<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위의 main.js에서는 두개의 <code class=\"language-text\">input</code> 요소에 <code class=\"language-text\">onChange</code>이벤트를 걸어서 두 <code class=\"language-text\">input</code> 중 하나의 값이 변경되면 <code class=\"language-text\">postMessage</code> 를 사용하여 두 요소의 값을 워커에게 보냅니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// myWorker.js</span>\n<span class=\"token function-variable function\">onmessage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> workerResult <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">poseMessage</span><span class=\"token punctuation\">(</span>workerResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">onmessage</code> 핸들러를 사용하면 메시지가 수신될 때마다 코드를 실행할 수 있으며, 메시지 자체는 메시지 이벤트의 data 속성에서 사용할 수 있습니다. 위 예시에서는 받은 두 값을 더해서 <code class=\"language-text\">poseMessage</code>로  결괏값을 다시 메인 스레드에게 보냅니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// main.js</span>\nworker<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onmessage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// e.data 사용</span>\n\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nworker<span class=\"token punctuation\">.</span><span class=\"token function\">terminate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>받은 결괏값을 메인에서 이런 식으로 받아와서 사용할 수 있습니다. 그리고 워커를 즉시 종료해야하는 경우 <code class=\"language-text\">terminate</code> 메서드를 호출하여 워커 스레드를 즉시 종료시킬 수 있습니다.</p>\n<h1>백그라운드에서 계산(데이터 처리) 수행하기</h1>\n<p>이제 실제로 Web Worker를 사용해서 로직을 수행하는 코드를 작성해보겠습니다. 저는 리액트를 사용해서 몇가지 계산을 수행하는 Web Worker를 구현해봤습니다.</p>\n<blockquote>\n<p>참고로 webpack4버전에서는 Web Worker를 사용하기위해 <code class=\"language-text\">worker-loader</code> 를 설치해서 사용해야했는데 webpack 5부터는 설치없이 Web Worker를 사용할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">Worker</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./worker.js'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">.</span>meta<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</blockquote>\n<h2>Web Worker 스레드 기능 구현</h2>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// worker.ts</span>\n<span class=\"token keyword\">const</span> calculateFunctions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">getDifference</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">firstNum</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">secondNum</span><span class=\"token operator\">:</span> number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">queryMethodListener</span><span class=\"token operator\">:</span> <span class=\"token string\">'difference'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">queryMethodArguments</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>firstNum <span class=\"token operator\">-</span> secondNum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function\">getMultiple</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">firstNum</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">secondNum</span><span class=\"token operator\">:</span> number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">queryMethodListener</span><span class=\"token operator\">:</span> <span class=\"token string\">'multiple'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">queryMethodArguments</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>firstNum <span class=\"token operator\">*</span> secondNum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function\">getFibonacci</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">firstNum</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">secondNum</span><span class=\"token operator\">:</span> number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">fibonacci</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">n</span><span class=\"token operator\">:</span> number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">fibonacci</span><span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token function\">fibonacci</span><span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">queryMethodListener</span><span class=\"token operator\">:</span> <span class=\"token string\">'fibonacci'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">queryMethodArguments</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token function\">fibonacci</span><span class=\"token punctuation\">(</span>firstNum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">fibonacci</span><span class=\"token punctuation\">(</span>secondNum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function-variable function\">onmessage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> queryMethod<span class=\"token punctuation\">,</span> queryMethodArguments <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>queryMethod <span class=\"token keyword\">in</span> calculateFunctions<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    calculateFunctions<span class=\"token punctuation\">[</span>queryMethod<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>queryMethodArguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">error</span><span class=\"token operator\">:</span> <span class=\"token string\">'Unknown queryMethod'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>우선 <code class=\"language-text\">calculateFunctions</code> 객체 내부에 각각 두 수의 차, 두 수의 곱 그리고 두 수의 피보나치 값을 계산해서 다시 메인 스레드로 보내주는 함수들을 만들었습니다. postMessage로 보낸 객체를 메인 스레드에서 받아서 결괏값을 화면에 보여주도록 할 것입니다.</p>\n<p>그리고 <code class=\"language-text\">onmessage</code> 핸들러를 만들어서 메시지를 수신하고 정의되어있는 queryMethod를 올바르게 받았을 때 해당하는 계산 함수를 실행하고 아니면 에러 메시지를 보내도록 설정하였습니다.</p>\n<h2>메인 스레드에서 Web Worker Instance 생성 및 실행</h2>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// WorkerComponent.tsx</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">WorkerComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token operator\">...</span>\n\n  <span class=\"token comment\">// 웹 워커 생성</span>\n  <span class=\"token keyword\">const</span> worker <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Worker</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./worker.ts'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">.</span>meta<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n\n\t<span class=\"token comment\">// 워커 스레드에서 받아온 값으로 보여줄 데이터 객체</span>\n  <span class=\"token keyword\">const</span> <span class=\"token literal-property property\">queryMethods</span><span class=\"token operator\">:</span> QueryMethods <span class=\"token operator\">=</span>  <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">difference</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">args</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Difference: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>args<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">multiple</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">args</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Multiple: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>args<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">fibonacci</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">args</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">First Fibonacci: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>args<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, Second Fibonacci: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>args<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 웹 워커 메시지 수신 이벤트 핸들러</span>\n    worker<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onmessage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> queryMethodListener<span class=\"token punctuation\">,</span> queryMethodArguments <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>data <span class=\"token keyword\">as</span> EventData<span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> queryMethods<span class=\"token punctuation\">[</span>queryMethodListener<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>queryMethodArguments<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"Invalid query method\"</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">setResult</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 컴포넌트 언마운트 시 웹 워커 제거</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      worker<span class=\"token punctuation\">.</span><span class=\"token function\">terminate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>worker<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// 워커에게 값을 보내는 이벤트 함수</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleGetDifference</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    worker<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">queryMethod</span><span class=\"token operator\">:</span> <span class=\"token string\">'getDifference'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">queryMethodArguments</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>inputNumObj<span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">,</span> inputNumObj<span class=\"token punctuation\">.</span>second<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleGetMultiple</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    worker<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">queryMethod</span><span class=\"token operator\">:</span> <span class=\"token string\">'getMultiple'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">queryMethodArguments</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>inputNumObj<span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">,</span> inputNumObj<span class=\"token punctuation\">.</span>second<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleGetFibonacci</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    worker<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">queryMethod</span><span class=\"token operator\">:</span> <span class=\"token string\">'getFibonacci'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">queryMethodArguments</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>inputNumObj<span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">,</span> inputNumObj<span class=\"token punctuation\">.</span>second<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> WorkerComponent<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Web Worker 스레드에게 이벤트를 보내고 처리된 값을 받아와서 화면에 보여주는 컴포넌트를 구현했습니다.</p>\n<p><code class=\"language-text\">new Worker()</code> 로 워커 인스턴스를 생성하고 컴포넌트가 마운트될 때 메시지를 수신하는 핸들러를 만들고 언마운트 시 웹 워커를 제거하도록 <code class=\"language-text\">useEffect</code> 내부에서 작업을 해두었습니다.</p>\n<p>마지막으로 버튼을 눌렀을 때 워커에게 계산을 수행할 값과 함께 메시지를 보내기 위한 이벤트 핸들러 함수를 만들었습니다. 만든 컴포넌트는 <a href=\"https://jeong-ki.github.io/webworker\" target=\"_blank\" rel=\"nofollow\">jeong-ki.github.io/webworker</a> 에서 테스트해볼 수 있습니다. (<a href=\"https://github.com/Jeong-ki/Jeong-ki.github.io/tree/develop/src/components/WebWorker\" target=\"_blank\" rel=\"nofollow\">코드보기</a>)</p>\n<blockquote>\n<p>만약 싱글 코어 컴퓨터인 경우 Web Worker를 사용한다 해도 거의 의미가 없어집니다. 이를 최적으로 사용하기 위해서는 CPU의 코어 수 만큼 Web Worker를 만들어서 사용하는 것이 가장 좋습니다.</p>\n<p><code class=\"language-text\">navigator.hardwareConcurrency</code> 를 사용하면 사용자 컴퓨터에서 스레드를 실행하는 데 사용할 수 있는 논리적 프로세서 수를 반환합니다. 즉, 컴퓨터의 CPU 코어의 수를 알 수 있습니다. 이를 활용해 코어의 수만큼 worker를 만들어 사용하는 코드도 만들어볼 수 있습니다.</p>\n</blockquote>\n<h1>Web Worker의 장단점</h1>\n<p>설명만 보면 정말 좋은 기능이고 꼭 써야할 것 같지만 실제로 많이 사용되고 있지는 않습니다.</p>\n<p>그 이유로는 우선 대부분의 웹에서 워커를 쓸 정도로 복잡한 작업을 하지 않기도 하고 DOM 제어 및 Window 객체의 일부 함수에 제약이 있기 때문입니다. 그리고 메인 스레드와 Web Worker간 데이터 전송에도 비용이 발생하기 때문에 위에서 만든 단순 계산하는 워커는 오히려 더 느리게 동작할 수도 있습니다.</p>\n<p>반면에 파일 핸들링이나 복잡한 계산이 필요한 경우, 백그라운드에서 지속적인 작업이 필요하거나 메인 스레드에 영향을 미치지 않고 작업을 하는 경우에 유용하게 사용할 수 있습니다. 이 외에도 빅 데이터 처리나 웹 게임 같은 분야에서 Web Worker를 사용할 수 있습니다.</p>","frontmatter":{"title":"Web Worker 멀티 스레드로 성능 개선하기","summary":"Web API인 Web Worker를 사용해서 멀티 스레드를 구현하고 성능을 개선해보자.","date":"2023년 07월 21일","categories":["JavaScript","Web API","Web Worker"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAUABQDASIAAhEBAxEB/8QAGwABAAEFAQAAAAAAAAAAAAAAAAQBAwUGCAn/xAAYAQACAwAAAAAAAAAAAAAAAAACBAADB//aAAwDAQACEAMQAAAB86c9u3ReoKcBKnLJNwGQwYf/xAAcEAACAwADAQAAAAAAAAAAAAAEBQECAwAGERP/2gAIAQEAAQUCGA0Iq9QkoGXvOmlqBTx1vU1VbRNbaR89NCCNp5//xAAkEQEAAgECBAcAAAAAAAAAAAACAQMEABIFESGhIjFBQmHR8P/aAAgBAwEBPwHEvGTlZHC7Khh2w8a6ji2VeqsRBBxOCREOLbr3NezYVfFh2nbCkrl8T3+tFshgtEtiWYUwXInwSojopPt5+XpqP3bX/8QAJBEAAgAFAwQDAAAAAAAAAAAAAQMAAgQFERIiMRMhQfBRcaH/2gAIAQIBAT8BuT3W2hF0kpqy6KGtU1tttMH12ssWJajexMqk06w1r5mzSr6e/O0CPefqMA4JAJAwCR3APOD4z5+YHv5H/8QAKBAAAgEDBAEBCQAAAAAAAAAAAgMBBBESAAUTMSFBBhAUFTJRYXKB/9oACAEBAAY/AsiYNOJSHE1+UJZHJC2lmMFNkXgmTAl4uMXOw6qdsqivUUop5A4nKZBtWLONingtqTiCywYOeFiiJgoKdHG7yltMzbZWmGJNyF1jH5YOEgsLuAqhanwJgo2jieU31vld7T7O/dX7rXMdskGNXUDTJKidwUDqn5hTGupip4/iHNiqTCFRg45m4EJeCibFE+hR4KPH2K9vxpqxIsYYUd94HOMzbuY7ifSetCTqh7SD6Ca5rJH9ZMikf57v/8QAHBABAQADAAMBAAAAAAAAAAAAAREAITFBUWFx/9oACAEBAAE/IYKOBcFAvi4iVvdCAJ8SULhGmmt6/cWeJBt1338ggE2fheXKnk+MMygWn69ygQAjsYgAiLNLqiPQ6MZXjgC73djzZclq21r7+v3P/9oADAMBAAIAAwAAABCP+ML/xAAZEQEAAwEBAAAAAAAAAAAAAAABABEhMVH/2gAIAQMBAT8QZuBIF984ujznGIJiBQSh7Y648plsiw0BMI6ir1DE0a99fZ//xAAcEQEAAgMAAwAAAAAAAAAAAAABESEAMUFRwdH/2gAIAQIBAT8QmEQfBTGqr7msLBGR0gRNISnkJTSUZOcMIRaoKOQh1OA8d9/Tn//EABoQAQEBAQADAAAAAAAAAAAAAAERACExQVH/2gAIAQEAAT8QAwZybsxciM5txuiG3T9LS6BFNSFIilE9JTv3zGl5mXn+DiZWOAMgANK+0al1r7uEi8VXXBFjg1WqELyObJTigVa7gDZQzZFCV6JVqu6ISZGqWqNVKqrV693/2Q=="},"images":{"fallback":{"src":"/static/5e539a61df87acc3e2336d926cbbbee5/44dd9/web_worker.jpg","srcSet":"/static/5e539a61df87acc3e2336d926cbbbee5/80079/web_worker.jpg 256w,\n/static/5e539a61df87acc3e2336d926cbbbee5/a008c/web_worker.jpg 512w,\n/static/5e539a61df87acc3e2336d926cbbbee5/44dd9/web_worker.jpg 1024w","sizes":"(min-width: 1024px) 1024px, 100vw"},"sources":[{"srcSet":"/static/5e539a61df87acc3e2336d926cbbbee5/99d55/web_worker.webp 256w,\n/static/5e539a61df87acc3e2336d926cbbbee5/3591c/web_worker.webp 512w,\n/static/5e539a61df87acc3e2336d926cbbbee5/e306d/web_worker.webp 1024w","type":"image/webp","sizes":"(min-width: 1024px) 1024px, 100vw"}]},"width":1024,"height":1024}},"publicURL":"/static/5e539a61df87acc3e2336d926cbbbee5/web_worker.jpeg"}}}}]},"file":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAUABQDASIAAhEBAxEB/8QAGgABAAMAAwAAAAAAAAAAAAAAAAQFBwIICf/EABYBAQEBAAAAAAAAAAAAAAAAAAIDAf/aAAwDAQACEAMQAAAB9samFlU6doUA51HExaMEf//EABsQAAIDAQEBAAAAAAAAAAAAAAIFAwQGARMi/9oACAEBAAEFAn7BtF1oiclXV2p7lGz6w6LNVLMLdF9p9InjawDks3wREQH/xAAbEQABBQEBAAAAAAAAAAAAAAABAhARIUFhgf/aAAgBAwEBPwFIqZSIu94eNg9b/8QAGxEAAgIDAQAAAAAAAAAAAAAAASEQEUFxgeH/2gAIAQIBAT8BJdNmtexk8j//xAAlEAACAgIBBAICAwAAAAAAAAACAwEEBRETABIUIQYiIzEyQVH/2gAIAQEABj8Cq0Pj9evYydh9Y3lantr0MTNoE3bxfYOVwiUjVriUkxm2SBrSYzasYf5DkE5s0JCu241TcVBhKRaZYvxTqDyrFpfjVBwxn1MY1pDrKYTa/Im2oN8YWqrmVrPF3TJSiXqMq5F9iTKyL3M9ZS3VGDyAYSAmqRzLrOOASdRbST/FpIyo36zVbD3cURsjvUJ1GeDxhQS2ni02cfexkY/HWVV5sUUTeEVd7W11s46oB9FKCVzCWHNB87graIvN3vfNfmbjv3/jXnG/7iNx610gvMvY+xXYxSrePYgHwjIL8G4ifJr2kytymQXtPIt6UPSa2Kguu0sPTbI9sCywE2HhxzHbK3vljkzsYLajCZmN9CADAAEQIiMQIiIxoRGI9RERGoiPUR1//8QAGBABAQEBAQAAAAAAAAAAAAAAAREAITH/2gAIAQEAAT8heI5/xCL6xdS/QnrkUaRG5hFplj5gRtmuZYCbud8Tj4PHy2ky22IUWr34DavOkL4AF7SsBUBBjVuMMy6TbcJKpAbbUxaLRpJx9o/iCIHhgAABv//aAAwDAQACAAMAAAAQFPgA/8QAGxEBAAIDAQEAAAAAAAAAAAAAAREhADFxEJH/2gAIAQMBAT8QFQgaAVsLIwaBUJK3WNL1xUjUvRTSJ8VTvn//xAAcEQEBAAICAwAAAAAAAAAAAAABESExAFEQcZH/2gAIAQIBAT8QmELcFACFIXZXNITE4aPRwBuDjYuxH6APYHXj/8QAFxABAQEBAAAAAAAAAAAAAAAAAREAIf/aAAgBAQABPxCX/FfjeibBnSlMyEvCdnXXdYGOOCBIkByZBL7Wk9AGI2YDYxBV33YyIdV6CrQr9/nTKCI2gC5SZiNz+gyXY06QsciQhqamF4bZmFgH/9k="},"images":{"fallback":{"src":"/static/ae91b527e5e44c319ca3c0dc2a238c15/c3a8c/profile-image.jpg","srcSet":"/static/ae91b527e5e44c319ca3c0dc2a238c15/2e59f/profile-image.jpg 11w,\n/static/ae91b527e5e44c319ca3c0dc2a238c15/ef9f5/profile-image.jpg 23w,\n/static/ae91b527e5e44c319ca3c0dc2a238c15/c3a8c/profile-image.jpg 45w,\n/static/ae91b527e5e44c319ca3c0dc2a238c15/936b0/profile-image.jpg 90w","sizes":"(min-width: 45px) 45px, 100vw"},"sources":[{"srcSet":"/static/ae91b527e5e44c319ca3c0dc2a238c15/0513d/profile-image.webp 11w,\n/static/ae91b527e5e44c319ca3c0dc2a238c15/31868/profile-image.webp 23w,\n/static/ae91b527e5e44c319ca3c0dc2a238c15/85c56/profile-image.webp 45w,\n/static/ae91b527e5e44c319ca3c0dc2a238c15/be9e0/profile-image.webp 90w","type":"image/webp","sizes":"(min-width: 45px) 45px, 100vw"}]},"width":45,"height":45}}}},"pageContext":{"slug":"/web_worker/"}},"staticQueryHashes":[],"slicesMap":{}}