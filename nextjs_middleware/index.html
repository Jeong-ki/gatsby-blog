<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.7.0"/><meta data-react-helmet="true" name="description" content="Next.js Middleware로 Private Route, Router Guard와 같은 페이지 접근 제어를 구현하자"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1.0"/><meta data-react-helmet="true" http-equiv="Content-Type" content="text/html;charset=UTF-8"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:title" content="Next.js에서 Middleware로 페이지 접근 제어 구현하기"/><meta data-react-helmet="true" property="og:description" content="Next.js Middleware로 Private Route, Router Guard와 같은 페이지 접근 제어를 구현하자"/><meta data-react-helmet="true" property="og:image" content="/static/db0b2581e45807694f69e6e622c63e66/nextjs_middleware.png"/><meta data-react-helmet="true" property="og:url"/><meta data-react-helmet="true" property="og:site_name" content="Next.js에서 Middleware로 페이지 접근 제어 구현하기"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Next.js에서 Middleware로 페이지 접근 제어 구현하기"/><meta data-react-helmet="true" name="twitter:description" content="Next.js Middleware로 Private Route, Router Guard와 같은 페이지 접근 제어를 구현하자"/><meta data-react-helmet="true" name="twitter:image" content="/static/db0b2581e45807694f69e6e622c63e66/nextjs_middleware.png"/><meta data-react-helmet="true" name="twitter:site" content="Jeong-Ki"/><meta data-react-helmet="true" name="twitter:creator" content="Jeong-Ki"/><meta data-react-helmet="true" name="google-site-verification" content="S7jPrYeCQFqTTA3JEsStCSo1ztA3wO6slosi2VSy3gQ"/><meta data-react-helmet="true" name="naver-site-verification" content="960a03e3d484ddced5ba2d9cb7c935d615735746"/><style data-href="/styles.9e907bc32054b7771552.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true">Next.js에서 Middleware로 페이지 접근 제어 구현하기</title><link rel="canonical" href="https://jeong-ki.github.io/nextjs_middleware/" data-baseprotocol="https:" data-basehost="jeong-ki.github.io"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><link rel="icon" href="/favicon-32x32.png?v=c11c817472d1e8d9ce09c7998e2b8059" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=c11c817472d1e8d9ce09c7998e2b8059"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=c11c817472d1e8d9ce09c7998e2b8059"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=c11c817472d1e8d9ce09c7998e2b8059"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=c11c817472d1e8d9ce09c7998e2b8059"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=c11c817472d1e8d9ce09c7998e2b8059"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=c11c817472d1e8d9ce09c7998e2b8059"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=c11c817472d1e8d9ce09c7998e2b8059"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=c11c817472d1e8d9ce09c7998e2b8059"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css 13ku56z">.css-13ku56z{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:100%;}</style><main class="css-13ku56z e1strnqo0"><style data-emotion="css-global 1yvxjw0">@import url('https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap');*{padding:0;margin:0;box-sizing:border-box;font-family:'Nanum Myeongjo',serif;}html,body,#___gatsby{height:100%;}#gatsby-focus-wrapper{height:100%;}a,a:hover{color:inherit;-webkit-text-decoration:none;text-decoration:none;cursor:pointer;}.gatsby-highlight{width:100%;}.img_wrapper{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;}.md_img{width:300px;height:300px;}.loop_img{width:500px;margin:20px 0;}</style><style data-emotion="css 1fjbs80">.css-1fjbs80{width:100%;height:70px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;padding:20px 50px;border-bottom:1px solid #eaecef;}@media (max-width: 1600px){.css-1fjbs80{padding:20px 50px;}}@media (max-width: 1200px){.css-1fjbs80{padding:20px;}}@media (max-width: 768px){.css-1fjbs80{padding:20px;}}</style><header class="css-1fjbs80 e1ke0ojz4"><style data-emotion="css 1n914y6">.css-1n914y6{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:23px;font-weight:500;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="css-1n914y6 e1ke0ojz3" href="/"><style data-emotion="css q4j1cl">.css-q4j1cl{width:45px;height:45px;}</style><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained css-q4j1cl erq0iyt0"><div style="max-width:45px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg%20height=&#x27;45&#x27;%20width=&#x27;45&#x27;%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAUABQDASIAAhEBAxEB/8QAGgABAAMAAwAAAAAAAAAAAAAAAAQFBwIICf/EABYBAQEBAAAAAAAAAAAAAAAAAAIDAf/aAAwDAQACEAMQAAAB9samFlU6doUA51HExaMEf//EABsQAAIDAQEBAAAAAAAAAAAAAAIFAwQGARMi/9oACAEBAAEFAn7BtF1oiclXV2p7lGz6w6LNVLMLdF9p9InjawDks3wREQH/xAAbEQABBQEBAAAAAAAAAAAAAAABAhARIUFhgf/aAAgBAwEBPwFIqZSIu94eNg9b/8QAGxEAAgIDAQAAAAAAAAAAAAAAASEQEUFxgeH/2gAIAQIBAT8BJdNmtexk8j//xAAlEAACAgIBBAICAwAAAAAAAAACAwEEBRETABIUIQYiIzEyQVH/2gAIAQEABj8Cq0Pj9evYydh9Y3lantr0MTNoE3bxfYOVwiUjVriUkxm2SBrSYzasYf5DkE5s0JCu241TcVBhKRaZYvxTqDyrFpfjVBwxn1MY1pDrKYTa/Im2oN8YWqrmVrPF3TJSiXqMq5F9iTKyL3M9ZS3VGDyAYSAmqRzLrOOASdRbST/FpIyo36zVbD3cURsjvUJ1GeDxhQS2ni02cfexkY/HWVV5sUUTeEVd7W11s46oB9FKCVzCWHNB87graIvN3vfNfmbjv3/jXnG/7iNx610gvMvY+xXYxSrePYgHwjIL8G4ifJr2kytymQXtPIt6UPSa2Kguu0sPTbI9sCywE2HhxzHbK3vljkzsYLajCZmN9CADAAEQIiMQIiIxoRGI9RERGoiPUR1//8QAGBABAQEBAQAAAAAAAAAAAAAAAREAITH/2gAIAQEAAT8heI5/xCL6xdS/QnrkUaRG5hFplj5gRtmuZYCbud8Tj4PHy2ky22IUWr34DavOkL4AF7SsBUBBjVuMMy6TbcJKpAbbUxaLRpJx9o/iCIHhgAABv//aAAwDAQACAAMAAAAQFPgA/8QAGxEBAAIDAQEAAAAAAAAAAAAAAREhADFxEJH/2gAIAQMBAT8QFQgaAVsLIwaBUJK3WNL1xUjUvRTSJ8VTvn//xAAcEQEBAAICAwAAAAAAAAAAAAABESExAFEQcZH/2gAIAQIBAT8QmELcFACFIXZXNITE4aPRwBuDjYuxH6APYHXj/8QAFxABAQEBAAAAAAAAAAAAAAAAAREAIf/aAAgBAQABPxCX/FfjeibBnSlMyEvCdnXXdYGOOCBIkByZBL7Wk9AGI2YDYxBV33YyIdV6CrQr9/nTKCI2gC5SZiNz+gyXY06QsciQhqamF4bZmFgH/9k=" alt=""/><picture><source type="image/webp" data-srcset="/static/ae91b527e5e44c319ca3c0dc2a238c15/0513d/profile-image.webp 11w,/static/ae91b527e5e44c319ca3c0dc2a238c15/31868/profile-image.webp 23w,/static/ae91b527e5e44c319ca3c0dc2a238c15/85c56/profile-image.webp 45w,/static/ae91b527e5e44c319ca3c0dc2a238c15/be9e0/profile-image.webp 90w" sizes="(min-width: 45px) 45px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 45px) 45px, 100vw" decoding="async" loading="lazy" data-src="/static/ae91b527e5e44c319ca3c0dc2a238c15/c3a8c/profile-image.jpg" data-srcset="/static/ae91b527e5e44c319ca3c0dc2a238c15/2e59f/profile-image.jpg 11w,/static/ae91b527e5e44c319ca3c0dc2a238c15/ef9f5/profile-image.jpg 23w,/static/ae91b527e5e44c319ca3c0dc2a238c15/c3a8c/profile-image.jpg 45w,/static/ae91b527e5e44c319ca3c0dc2a238c15/936b0/profile-image.jpg 90w" alt="Logo Image"/></picture><noscript><picture><source type="image/webp" srcSet="/static/ae91b527e5e44c319ca3c0dc2a238c15/0513d/profile-image.webp 11w,/static/ae91b527e5e44c319ca3c0dc2a238c15/31868/profile-image.webp 23w,/static/ae91b527e5e44c319ca3c0dc2a238c15/85c56/profile-image.webp 45w,/static/ae91b527e5e44c319ca3c0dc2a238c15/be9e0/profile-image.webp 90w" sizes="(min-width: 45px) 45px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 45px) 45px, 100vw" decoding="async" loading="lazy" src="/static/ae91b527e5e44c319ca3c0dc2a238c15/c3a8c/profile-image.jpg" srcSet="/static/ae91b527e5e44c319ca3c0dc2a238c15/2e59f/profile-image.jpg 11w,/static/ae91b527e5e44c319ca3c0dc2a238c15/ef9f5/profile-image.jpg 23w,/static/ae91b527e5e44c319ca3c0dc2a238c15/c3a8c/profile-image.jpg 45w,/static/ae91b527e5e44c319ca3c0dc2a238c15/936b0/profile-image.jpg 90w" alt="Logo Image"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><style data-emotion="css rnv3zy">.css-rnv3zy{margin-left:8px;font-size:21px;font-weight:400;}</style><h1 class="css-rnv3zy e1ke0ojz2">DevDog</h1></a><style data-emotion="css s5xdrg">.css-s5xdrg{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-s5xdrg e1ke0ojz1"><style data-emotion="css 1lsk361">.css-1lsk361{border-bottom:2px solid #fff;}</style><style data-emotion="css 6lwpb1">.css-6lwpb1{margin-right:35px;padding-bottom:3px;border-bottom:2px solid #fff;}</style><a class="css-6lwpb1 e1ke0ojz0" href="/">Post</a><a class="css-6lwpb1 e1ke0ojz0" href="/about/">About</a></div></header><style data-emotion="css eb44u6">.css-eb44u6{text-align:center;}@media (max-width: 768px){.css-eb44u6{height:300px;}}</style><header class="css-eb44u6 e1opi4mu0"><style data-emotion="css 1a6xfgf">.css-1a6xfgf{display:-webkit-box;display:-webkit-box;display:-webkit--webkit-flex;display:-ms--webkit-flexbox;display:-webkit-flex;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;max-width:900px;padding:2rem;margin-left:auto;margin-right:auto;}</style><div class="css-1a6xfgf e1st1jau5"><style data-emotion="css pjec3t">.css-pjec3t{display:-webkit-box;display:-webkit-box;display:-webkit--webkit-flex;display:-ms--webkit-flexbox;display:-webkit-flex;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;width:100%;padding:0 1.5rem;}</style><div class="css-pjec3t e1st1jau4"><style data-emotion="css 16rbmso">.css-16rbmso{text-align:left;color:inherit;font-size:2.5rem;line-height:1.5;font-weight:700;}@media (max-width: 768px){.css-16rbmso{font-size:30px;}}</style><h2 class="css-16rbmso e1st1jau3">Next.js에서 Middleware로 페이지 접근 제어 구현하기</h2><style data-emotion="css sj2khc">.css-sj2khc{display:-webkit-box;display:-webkit-box;display:-webkit--webkit-flex;display:-ms--webkit-flexbox;display:-webkit-flex;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;position:relative;min-width:1px;max-width:100%;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;box-sizing:border-box;-webkit-flex:1;-ms-flex:1;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-flex-direction:row;-ms-flex-direction:row;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}</style><div class="css-sj2khc e1st1jau2"><style data-emotion="css 1km1x8x">.css-1km1x8x{display:inline-block;vertical-align:middle;border-radius:16px;font-weight:500;line-height:1;cursor:inherit;font-feature-settings:tnum;font-variant:tabular-nums;text-transform:capitalize;white-space:nowrap;background:#000;color:#ffffff;border:1px solid #000;padding:4px 10px;font-size:1rem;margin-right:5px;margin:15px 5px 15px 0;}@media (max-width: 768px){.css-1km1x8x{font-size:0.8rem;padding:3px 8px;}}</style><span class="css-1km1x8x e1st1jau1"># <!-- -->Nextjs</span><span class="css-1km1x8x e1st1jau1"># <!-- -->Middleware</span><span class="css-1km1x8x e1st1jau1"># <!-- -->Routing</span></div><style data-emotion="css 12dir48">.css-12dir48{color:inherit;font-size:0.875rem;line-height:1.5;color:#666;}@media (max-width: 768px){.css-12dir48{font-size:0.8rem;}}</style><span class="css-12dir48 e1st1jau0">2023년 08월 20일</span></div></div></header><style data-emotion="css 1flj9lk">.css-1flj9lk{text-align:left;}</style><div class="css-1flj9lk e1ijh0y12"><style data-emotion="css y3nlyb">.css-y3nlyb{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-box-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;max-width:900px;padding:2rem;margin-left:auto;margin-right:auto;}</style><div class="css-y3nlyb e1ijh0y11"><style data-emotion="css 51uix0">.css-51uix0{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;word-break:break-all;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;width:100%;padding:0 1.5rem;word-break:break-all;line-height:1.8;font-size:16px;font-weight:400;}.css-51uix0 p{padding:3px 0;}.css-51uix0 h1,.css-51uix0 h2,.css-51uix0 h3{font-weight:800;margin-bottom:30px;}.css-51uix0 *+h1,.css-51uix0 *+h2,.css-51uix0 *+h3{margin-top:80px;}.css-51uix0 hr+h1,.css-51uix0 hr+h2,.css-51uix0 hr+h3{margin-top:0;}.css-51uix0 h1{font-size:30px;}.css-51uix0 h2{font-size:25px;}.css-51uix0 h3{font-size:20px;}.css-51uix0 blockquote{margin:30px 0;padding:5px 15px;border-left:2px solid #000000;font-weight:800;}.css-51uix0 ol,.css-51uix0 ul{margin-left:20px;padding:30px 0;}.css-51uix0 hr{border:1px solid #000000;margin:100px 0;}.css-51uix0 a{color:#4263eb;-webkit-text-decoration:underline;text-decoration:underline;}.css-51uix0 pre[class*='language-']{margin:30px 0;padding:15px;font-size:15px;}.css-51uix0 pre[class*='language-']::-webkit-scrollbar-thumb{background:rgba(255, 255, 255, 0.5);border-radius:3px;}.css-51uix0 code[class*='language-'],.css-51uix0 pre[class*='language-']{tab-size:2;}@media (max-width: 768px){.css-51uix0{width:100%;padding:20px 20px 40px;line-height:1.6;font-size:14px;}.css-51uix0 h1{font-size:23px;}.css-51uix0 h2{font-size:20px;}.css-51uix0 h3{font-size:17px;}.css-51uix0 img{width:100%;}.css-51uix0 hr{margin:50px 0;}}</style><div class="css-51uix0 e1ijh0y10"><p>개발을 하면서 로그인 상태 또는 권한에 따라 권한이 없는 사용자가 어떠한 루트로 접근하는 것을 막아야하는 경우가 많습니다. 이를 구현하는 다양한 방법들이 있는데 Vue에서 <code class="language-text">vue-router</code>가 제공하는 Navigation Guard로 이를 구현하거나 React에서 Private Route 컴포넌트를 만들어서 <code class="language-text">react-router-dom</code>의 Route에서 필요한 페이지에 이를 감싸주는 방식을 많이 사용합니다.</p>
<p>제가 진행한 Next.js 프로젝트에서 리액트의 방식을 그대로 사용하려 했는데 불편함을 느끼고 Next.js의 Middleware를 사용해서 이를 개선한 사례를 소개해드리겠습니다.</p>
<h1>초기 접근제어 방식</h1>
<p>처음 접근제어를 구현하기위해 저는 <code class="language-text">&lt;AuthLayout></code> 이라는 컴포넌트를 만들어 제어가 필요한 페이지의 layout에 이를 감싸주는 방식으로 접근제어를 구현하였습니다.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">AuthLayout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">children</span><span class="token operator">:</span> React<span class="token punctuation">.</span>ReactNode <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> pathname <span class="token operator">=</span> <span class="token function">usePathname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> isAuthenticated <span class="token operator">=</span> <span class="token function">getAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isAuthenticated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>router<span class="token punctuation">,</span> pathname<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> AuthLayout<span class="token punctuation">;</span></code></pre></div>
<p>그러나 위와 같은 방식으로 구현했을 때 React와 Next.js의 차이로인해 보다 불편한 점이 있었는데 React에서는 react-router-dom을 사용해서 app.js 파일에서 라우터를 통합 관리하기 때문에 한눈에 어떤 페이지에서 이를 적용하였는지 알 수 있고 필요한 페이지에 이를 적용하거나 제거하기 용이하였습니다.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// React 예시</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> cardRepo <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Router</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>/<span class="token punctuation">'</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>/login<span class="token punctuation">'</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Login</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span>
          <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>/search<span class="token punctuation">'</span></span>
          <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AuthLayout</span></span><span class="token punctuation">></span></span><span class="token plain-text">
              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Search</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">AuthLayout</span></span><span class="token punctuation">></span></span>
          <span class="token punctuation">}</span></span>
        <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span>
          <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>/user<span class="token punctuation">'</span></span>
          <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AuthLayout</span></span><span class="token punctuation">></span></span><span class="token plain-text">
              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">User</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">AuthLayout</span></span><span class="token punctuation">></span></span>
          <span class="token punctuation">}</span></span>
        <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Router</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>그러나 Next.js에서는 폴더 구조를 통해서 라우팅 처리를 자동적으로 처리해주기 때문에 적용할 페이지를 찾아서 layout에 직접 감싸주어야 하고 내가 어떤 페이지에 적용했는지 찾거나 제거하기 위해서는 일일이 확인해야 한다는 단점이 있습니다. 이를 해결하기위해 Next.js의 Middleware를 사용하였습니다.</p>
<h1>Next.js Middleware란</h1>
<p>공식문서 Middleware 설명을 보면 “Middleware는 요청이 완료되기 전에 코드를 실행할 수 있고 그에 따라 응답을 수정할 수 있습니다. 그런 다음 들어오는 요청에 따라 요청 또는 응답 헤더를 재작성, 리다이렉션, 수정하거나 직접 응답하여 응답을 수정할 수 있습니다. 그리고 Middleware는 캐시된 콘텐츠와 경로가 일치하기 전에 실행됩니다.” 라고 되어있습니다.</p>
<p>이를 간단히 말하면 사용자의 요청을 처리하여 응답을 반환하기 전에 조작하여 응답할 수 있는 것입니다. 즉, Middleware를 사용하여 요청 및 응답을 수정할 수 있고 기본적으로 요청 헤더, 응답 헤더, 쿠키, 경로 등을 수정할 수 있습니다. 이를 활용하여 페이지 접근 제어를 간단하게 구현할 수 있습니다.</p>
<blockquote>
<p>Next.js Middleware는 <a href="https://vercel.com/docs/functions/edge-functions/edge-runtime" target="_blank" rel="nofollow">Edge Runtime</a>을 사용하기 때문에 Node.js APIs나 Browser APIs와 같은 API를 사용할 수 없고 Middleware APIs를 사용해야합니다.</p>
</blockquote>
<h1>Middleware로 접근 제어 구현</h1>
<p>우선 middleware를 사용하기 위해서 middleware.ts를 프로젝트의 루트에 넣어주어야합니다. (ex. src/middleware.ts)</p>
<p>간단한 사용 예시를 살펴보면 아래와 같이 작성할 수 있습니다. 아래 예시 코드를 그대로 적용하면 이제 /test 경로를 사용자가 이동하였을 때 /home으로 변하여 경로가 바뀌게 됩니다. 가장 아래의 matcher에 해당하는 경로일 경우에만 위 middleware가 실행되는 것입니다.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> NextResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/server'</span>
<span class="token keyword">import</span> type <span class="token punctuation">{</span> NextRequest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/server'</span>
 
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">middleware</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">request</span><span class="token operator">:</span> NextRequest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> NextResponse<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'/home'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">export</span> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">matcher</span><span class="token operator">:</span> <span class="token string">'/test'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div>
<p>이제 이를 조금만 응용해서 토큰이 있는지 확인하는 코드만 추가하면 바로 접근 제어를 구현할 수 있습니다.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">
<span class="token keyword">import</span> <span class="token punctuation">{</span> NextResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/server'</span>
<span class="token keyword">import</span> type <span class="token punctuation">{</span> NextRequest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/server'</span>
 
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">middleware</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">request</span><span class="token operator">:</span> NextRequest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> cookieToken <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cookieToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  <span class="token keyword">return</span> NextResponse<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">export</span> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">matcher</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token string">'/user'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div>
<p>기존 방식은 useEffect를 통해 CSR 방식으로 사용자의 로그인 상태를 확인하고 페이지를 라우팅하는데 이때 useEffect는 비동기적으로 화면이 렌더링되고 동작하기 때문에 사용자에게 잠시동안 초기 상태의 화면이 보이는 문제가 있습니다. 그에 반해 Middleware는 사용자에게 요청이 오면 응답 전에 처리를 해서 주기 때문에 요청이 오면 로그인 되었는지 확인을 하고 각 페이지로 가도록 동작하기 때문에 응답 시간을 개선하고 사용자 경험 문제도 해결할 수 있습니다.</p>
<h1>추가적인 Middleware 사용법</h1>
<p>접근 제어 외에도 Next.js의 Middleware로 할 수 있는 것들이 많은데 저는 Geolocation과 A/B Test가 흥미로워 보여서 한번 사용해보고 싶다고 느꼈습니다.</p>
<h2>Geolocation</h2>
<p>Next.js middleware에서 제공하는 NextRequest API의 <code class="language-text">geo</code> 를 통해 지리 정보에 대한 엑세스를 제공합니다. 이를 통해 사용자의 위치를 알 수 있고 사용자의 위치를 기반으로한 콘텐츠를 만들 수도 있습니다.</p>
<blockquote>
<p>Vercel에 배포하면 GeoIP에 데이터가 표시되고 로컬 환경에서는 사용자의 위치를 알 방법이 없기 때문에 해당 데이터가 비어있다.</p>
</blockquote>
<h2>A/B 테스트</h2>
<p>Middleware를 사용한 A/B 테스트는 쿠키를 사용하여 사용자를 특정 버킷에 할당한 다음 서버가 할당된 버킷에 따라 사용자를 A 또는 B 버전으로 리다이렉션 시킵니다. 이전에는 개발자가 정적 사이트의 클라이언트 측에서 A/B 테스트를 수행하여 처리 속도가 느려지고 레이아웃이 변경될 수 있었지만 Next.js Middleware는 사용자 요청의 서버측 처리를 가능하게 하여 프로세스를 더 빠르게하고 레이아웃 변경을 방지합니다.</p>
<p>이 외에도 Next.js Middleware로 할 수 있는 흥미로운 방안들이 많고 Middleware 뿐만 아니라 계속해서 다양한 기능들을 제공해주는 Next.js를 잘 이해하고 사용한다면 효과적이고 효율적으로 개발을 할 수 있을 것입니다.</p></div></div></div><style data-emotion="css 11szvr4">.css-11szvr4{padding:0 3.5rem;}</style><div class="css-11szvr4 e1gqsjds0"></div><style data-emotion="css 9w9jmx">.css-9w9jmx{display:grid;place-items:center;margin-top:auto;padding:50px 0;font-size:15px;text-align:center;line-height:1.5;}@media (max-width: 768px){.css-9w9jmx{font-size:13px;}}</style><footer class="css-9w9jmx e1oae0v81">Copyright © 2023 Developer Jeong-Ki<style data-emotion="css 4w6y58">.css-4w6y58{color:#848484;margin-top:10px;}</style><p class="css-4w6y58 e1oae0v80">gisuu9@gmail.com . +82-10-2926-3532 .<!-- --> <a href="https://github.com/Jeong-ki">Jeong-ki&#x27;s Github</a></p></footer></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/nextjs_middleware/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-f72f5b0491887d814c17.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-21c80a2608efdbc8a2a7.js\"],\"component---src-pages-about-tsx\":[\"/component---src-pages-about-tsx-07b9832ee60a0b785d37.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-33a1e50686d7badd13c6.js\"],\"component---src-pages-info-tsx\":[\"/component---src-pages-info-tsx-8dfd4d1fd48a1c5f6635.js\"],\"component---src-templates-post-template-tsx\":[\"/component---src-templates-post-template-tsx-cdc86507a8cad3d5802a.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="2fe7e957272b48ca129d";</script><script src="/webpack-runtime-cc811e6028fc8a6da5fd.js" async></script><script src="/framework-a4e155cd0476dc1ca208.js" async></script><script src="/app-f72f5b0491887d814c17.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>